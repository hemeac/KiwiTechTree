// Kiwi's Tech Tree Overhaul (Bluedog_DB by CobaltWolf Kerbalism Science Patch - Authored by CessnaSkyhawk)
// Version 1.5
// Created: August 2 2021 for KSP 1.11.2
// Last Updated: August 3 2021
// August 3 2021 General clean up to make it PR ready
//August 8 2021 Finalization of Wx and SIGINT experiments, and clean up to send to PR. Still needs some tweaks, but general code should mostly be all set.
//NOTE - one minor issue I haven't been able to fix is getting the cameras to open when I activiate the experiment. Doesn't effect gameplay much, but still should be figured out.

//Removing the experiments Kerbalism supports already so they can be replaced with the KTT version for maximum saftey (seems like just leaving it alone causes Kerbalism to miss a couple of the magnetometers...)
!EXPERIMENT_DEFINITION:HAS[#id[bd_camera]]:NEEDS[Bluedog_DB,FeatureScience] {}
!EXPERIMENT_DEFINITION:HAS[#id[bd_magScan]]:NEEDS[Bluedog_DB,FeatureScience] {}
!EXPERIMENT_DEFINITION:HAS[#id[bd_IRspec]]:NEEDS[Bluedog_DB,FeatureScience] {}
!EXPERIMENT_DEFINITION:HAS[#id[bd_surveillance]]:NEEDS[Bluedog_DB,FeatureScience] {}

@PART[bluedog*]:NEEDS[Bluedog_DB,FeatureScience]
{
	!MODULE[*ModuleScience*],* {}
}

@PART[bluedog_Vanguard_Satellite3|bluedog_Mariner2_Truss|bluedog_MarinerB_Truss|bluedog_Ranger_Block1_Truss|bluedog_OGO_LongBoom_Hoop|bluedog_Gemini_Magnetometer|bluedog_mariner10_magnetometer|bluedog_Helios_Magnetometer|bluedog_foldingMag|bluedog_Transit5_Magnetometer|bluedog_Tranist5_Magnetometer_Equipment|bluedog_Pioneer6_Magnetometer|bluedog_Biosat_Magnetometer|bluedog_IMP_Magnetometer|bluedog_AIMP_Magnetometer]:NEEDS[Bluedog_DB,FeatureScience] // Magnometers
{
	!MODULE[*ModuleScience*],* {}
	
	MODULE
	{
		name = Experiment
		experiment_id = magnetometer
		anim_deploy = deploy
	}
}

@PART[bluedog_PioneerAble_Core|bluedog_Geiger|bluedog_GATV_NuclearPackage|bluedog_Pioneer_1|bluedog_Juno1_Explorer1|bluedog_Explorer_S46]:NEEDS[Bluedog_DB,FeatureScience] // Rad Scan
{
	!MODULE[*ModuleScience*],* {}
	
	MODULE
	{
		name = Experiment
		experiment_id = geigerCounter
	}
}

@PART[bluedog_OGO_LongBoom_Ball|bluedog_Ranger_Block2_GammaRaySpectrometer]:NEEDS[Bluedog_DB,FeatureScience] // Gamma Ray
{
	!MODULE[*ModuleScience*],* {}
	
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_gammaRay
	}
}

@PART[bluedog_Pioneer_4|bluedog_Vanguard_Satellite2]:NEEDS[Bluedog_DB,FeatureScience] // Photometry
{
	!MODULE[*ModuleScience*],* {}
	
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_photometer
	}
}

@PART[bluedog_OSO_Photometer]:NEEDS[Bluedog_DB,FeatureScience] //Photopolarimeter Experiment - strangely, although the name of the part is a Photometer, its "stock" science experiment is photopolarimetry
{
	!MODULE[*ModuleScience*],* {}
	
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_photopolarimeter
	}
}

@PART[bluedog_hydrometer]:NEEDS[Bluedog_DB,FeatureScience] //hydrometer
{
	!MODULE[*ModuleScience*],* {}
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_hydrometer
	}
}

@PART[bluedog_Mariner2_Radiometer|bluedog_Nimbus_Instrument_SMMR|bluedog_Nimbus_Instrument_ESMR|bluedog_Nimbus_Instrument_SIS|bluedog_Nimbus_Instrument_THIR|bluedog_IRspec|bluedog_Explorer_7|bluedog_mariner10_plasmaScience]:NEEDS[Bluedog_DB,FeatureScience] //IR spectrometer
{
	!MODULE[*ModuleScience*],* {}
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_IRspec
		anim_deploy = deploy
	}
}

@PART[bluedog_Transit5_UVSpectrometer|bluedog_mariner10_UVspectrometer|bluedog_Ranger_Block1_LymanAlphaTelescope]:NEEDS[Bluedog_DB,FeatureScience] //UV spectrometer
{
	!MODULE[*ModuleScience*],* {}
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_UVspec
		anim_deploy = deploy
	}
}

@PART[bluedog_OAO_WEP_instrument|bluedog_OAO3_PEP_instrument]:NEEDS[Bluedog_DB,FeatureScience] //UV Telescopes
{
	!MODULE[*ModuleScience*],* {}
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_UVtelescope
		anim_deploy = deploy
	}
}

@PART[bluedog_mariner10_plasmaScience|bluedog_Explorer_8|bluedog_Ranger_Block1_ElectroAnalyzer_Experiment|bluedog_OGO_ExperimentBoom_1]:NEEDS[Bluedog_DB,FeatureScience] //Ionization analysis
{
	!MODULE[*ModuleScience*],* {}
	MODULE
	{
		name = Experiment
		experiment_id = kiwi_ionElec
		anim_deploy = deploy
	}
}


@PART[bluedog_MiniGoo]:NEEDS[Bluedog_DB,FeatureScience] //The Goo...
{
	MODULE
	{
		name = HardDrive
		experiment_id = mysteryGoo
		dataCapacity = 0
		sampleCapacity = 1
	}
}

@PART[bluedog_cameraLowTech|bluedog_LunarOrbiter_Camera|bluedog_cameraMidTech|bluedog_Gemini_LunarRecon_Camera|bluedog_Ranger_Block2_TVCamera|bluedog_Ranger_Block3_TVSystem]:NEEDS[FeatureScience,Bluedog_DB]:FIRST //Replacing the Kerbalism "Take Photographs" with the KTT one
{
	!MODULE[ModuleScienceExperiment],* {}// Get rid of the pre-configured experiments
	MODULE
	{
		name = Configure
		title = Early Camera Experiments
	}
}

@PART[bluedog_cameraHighTech|bluedog_mariner10_camera*|bluedog_Hexagon_MappingCamera]:NEEDS[FeatureScience,Bluedog_DB]:FIRST
{
	!MODULE[ModuleScienceExperiment],* {}// Get rid of the pre-configured experiments
	MODULE
	{
		name = Configure
		title = Digital Camera Experiments
	}
}

@PART[bluedog_OFO_Experiment|bluedog_Biosat_Adapter]:NEEDS[FeatureScience,Bluedog_DB]:FIRST //Making these compatible with the KTT Animal Tests
{
	!MODULE[ModuleScienceExperiment],* {}// Get rid of the pre-configured experiments
	MODULE
	{
		name = Configure
		title = Living Creature Experiments
	}
	
}

//Custom Experiments
//Early Communication Tests
EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = earlyCommTests
	title = Early Communication Tests
	baseValue = 50
	scienceCap = 50
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = Ping! Ping! Ping! It seems like it would be a lot of fun to bounce between relays!
		default = You use the satellites to transmit a Khristmas greeting from President Keisenhower
		default = Mission Control stress-tests the satellite by relaying video from the 1964th Kolympics through it	
	}
}

//TIROS Weather Experiment
EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = TIROS
	title = TIROS
	baseValue = 4
	scienceCap = 4
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = That's a big hurricane...
	}
}


//Grouped Weather Experiments
EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = NWS
	title = NWS
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = From a sun-synchronous orbit, we are collecting useful scans of all sorts of enviromental data!
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = GOES
	title = GOES
	baseValue = 750
	scienceCap = 750
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = This data downlink is very useful to all the weather agencies back home!
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = WAMUU
	title = WAMUU
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = A long term observation of airflow and cloud cover patterns will help us gain a better understanding of the planet's climate.
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = ESIDISI
	title = ESIDISI
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = Highly focused scans help us identify which regions of this planet face the worst storms, so we know where we wouldn't want to land!
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = KARS
	title = KARS
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = Even the ultimate lifeform wouldn't be able to brave these harsh radiation belts, but so far, this probe's doing just fine!
	}
}

//Military Science Experiments
EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = BATTLE
	title = BATTLE
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = You note that the Krussians seem to be moving troops into the Krimean Peninsula.
		default = The Khinese-Kindian border is clearly visible from space, with masses of troops and large fortifications on both sides.
		default = You observe a series of squabbles over the contested city of Kerbul.
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = COMBAT
	title = COMBAT
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = Hey! That Krussian base just launched a rocket! Why does it look like it's coming right towards us...
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = FIGHT
	title = FIGHT
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = The resoulution of this advanced camera is unreal. 
		default = You wonder why the military's #1 most important target was "the color of the base commander's underwear".
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = WARS
	title = WARS
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = These large-scale images make the entire world looks like a game of Krisk.
		default = What was that big flash! Could it have been a nuclear test... We should let someone know.
	}
}

EXPERIMENT_DEFINITION:NEEDS[Bluedog_DB,FeatureScience]
{
	id = CORONA
	title = CORONA
	baseValue = 100
	scienceCap = 100
	dataScale = 1
	
	requireAtmosphere = True
	situationMask = 16
	biomeMask = 16
	
	RESULTS
	{
		default = These fancy military cameras do just a good a job taking pictures of other worlds as well!
	}
}

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience,Bluedog_DB]
{
	WEATHER_EXPERIMENTS
	{
		BaseSlots = 1

		TIROS									
		{
			ECCost = 1					
			size = 4
			value = 3						
			duration = 5 
			SetupMass = 
			SetupCost = 
			UnlockTech = 
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates = 			
		}
		NWS									
		{
			ECCost = 3					
			size = 750000
			value = 200						
			duration = 18705600 
			SetupMass = .02
			SetupCost = 1000
			UnlockTech = exactScience
			requirements = Sunlight,OrbitMaxInclination:102,OrbitMinInclination:94
			CrewRequirement = 
			ResourceRates = 			
		}		
		GOES									
		{
			ECCost = 10					
			size = 5000000
			value = 900						
			duration = 140292000 
			SetupMass = .05
			SetupCost = 5000
			UnlockTech = scienceTech
			requirements = OrbitMaxInclination:3,OrbitMaxEccentricity:.01,AltitudeMin:2800000
			CrewRequirement = 
			ResourceRates = 			
		}
		WAMUU									
		{
			ECCost = 5				
			size = 900000
			value = 50						
			duration = 37411200 //4 Years 
			SetupMass = .025
			SetupCost = 2500
			UnlockTech = advScienceTech
			requirements = OrbitMaxInclination:7,OrbitMaxEccentricity:.01
			CrewRequirement = 
			ResourceRates = 			
		}
		ESIDISI									
		{
			ECCost = 3				
			size = 750000
			value = 40						
			duration = 18705600 //2 Years
			SetupMass = .02
			SetupCost = 2000
			UnlockTech = advScienceTech
			requirements = Sunlight,OrbitMaxInclination:85,OrbitMinInclination:95
			CrewRequirement = 
			ResourceRates = 			
		}
		KARS									
		{
			ECCost = 1				
			size = 500000
			value = 75						
			duration = 648000 //30 days 
			SetupMass = .01
			SetupCost = 7000
			UnlockTech = experimentalScience
			requirements = 
			CrewRequirement = 
			ResourceRates = 			
		}
	}
}

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience,Bluedog_DB]
{
	KEYHOLE_EXPERIMENTS
	{
		BaseSlots = 1

		BATTLE	//Biome-based							
		{
			ECCost = .25					
			size = 1024
			value = 7						
			duration = 75600 
			SetupMass = .02
			SetupCost = 1000
			UnlockTech = 
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates = 				
		}		
		COMBAT	//Biome-based									
		{
			ECCost = 1					
			size = 2048
			value = 14						
			duration = 151200 
			SetupMass = .05
			SetupCost = 5000
			UnlockTech = scienceTech
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates =		
		}
		FIGHT //Biome-based								
		{
			ECCost = 2				
			size = 3072
			value = 28						
			duration = 648000 //30 days 
			SetupMass = .025
			SetupCost = 2500
			UnlockTech = advScienceTech
			requirements = 
			CrewRequirement = 
			ResourceRates = 				
		}
		WARS	//Hemisphere Based								
		{
			ECCost = 5				
			size = 24576
			value = 75					
			duration = 8640000 //1 Year
			SetupMass = .02
			SetupCost = 2000
			UnlockTech = specializedScienceTech
			requirements = 
			CrewRequirement = 
			ResourceRates =	 			
		}
		CORONA	//Biome-based								
		{
			ECCost = 1				
			size = 2048
			value = 40						
			duration = 3600 
			SetupMass = .01
			SetupCost = 7000
			UnlockTech = experimentalScience
			requirements = 
			CrewRequirement = 
			ResourceRates = 			
		}
	}
}

// These aren't being referenced, but won't delete
@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience,Bluedog_DB]
{
	Bluedog_DB
	{
		earlyCommTests									
		{
			ECCost = 					
			size = 800
			value = 50						
			duration = 9352800 //Just over a year
			SetupMass = 
			SetupCost = 
			UnlockTech = 
			requirements = 
			CrewRequirement = 
			ResourceRates = 			
		}
		TIROS									
		{
			ECCost = 1					
			size = 4
			value = 3						
			duration = 5 
			SetupMass = 
			SetupCost = 
			UnlockTech = 
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates = 			
		}
		NWS									
		{
			ECCost = 3					
			size = 750000
			value = 200						
			duration = 18705600 
			SetupMass = .02
			SetupCost = 1000
			UnlockTech = exactScience
			requirements = Sunlight,OrbitMaxInclination:102,OrbitMinInclination:94
			CrewRequirement = 
			ResourceRates = 			
		}		
		GOES									
		{
			ECCost = 10					
			size = 5000000
			value = 900						
			duration = 140292000 
			SetupMass = .05
			SetupCost = 5000
			UnlockTech = scienceTech
			requirements = OrbitMaxInclination:3,OrbitMaxEccentricity:.01,AltitudeMin:2800000
			CrewRequirement = 
			ResourceRates = 			
		}
		WAMUU									
		{
			ECCost = 5				
			size = 900000
			value = 50						
			duration = 37411200 //4 Years 
			SetupMass = .025
			SetupCost = 2500
			UnlockTech = advScienceTech
			requirements = OrbitMaxInclination:7,OrbitMaxEccentricity:.01
			CrewRequirement = 
			ResourceRates = 			
		}
		ESIDISI									
		{
			ECCost = 3				
			size = 750000
			value = 40						
			duration = 18705600 //2 Years
			SetupMass = .02
			SetupCost = 2000
			UnlockTech = advScienceTech
			requirements = Sunlight,OrbitMaxInclination:85,OrbitMinInclination:95
			CrewRequirement = 
			ResourceRates = 			
		}
		KARS									
		{
			ECCost = 1				
			size = 500000
			value = 75						
			duration = 648000 //30 days 
			SetupMass = .01
			SetupCost = 7000
			UnlockTech = experimentalScience
			requirements = 
			CrewRequirement = 
			ResourceRates = 			
		}
		BATTLE	//Biome-based							
		{
			ECCost = .25					
			size = 1024
			value = 7						
			duration = 75600 
			SetupMass = .05
			SetupCost = 1000
			UnlockTech = 
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates = 				
		}		
		COMBAT	//Biome-based									
		{
			ECCost = 1					
			size = 2048
			value = 14						
			duration = 151200 
			SetupMass = .1
			SetupCost = 2000
			UnlockTech = scienceTech
			requirements = Sunlight
			CrewRequirement = 
			ResourceRates =		
		}
		FIGHT //Biome-based								
		{
			ECCost = 2				
			size = 3072
			value = 28						
			duration = 648000 //30 days 
			SetupMass = .2
			SetupCost = 4000
			UnlockTech = advScienceTech
			requirements = 
			CrewRequirement = 
			ResourceRates = 				
		}
		WARS	//Hemisphere Based								
		{
			ECCost = 5				
			size = 24576
			value = 75					
			duration = 8640000 //1 Year
			SetupMass = .3
			SetupCost = 12000
			UnlockTech = specializedScienceTech
			requirements = 
			CrewRequirement = 
			ResourceRates =	 			
		}
		CORONA	//Biome-based								
		{
			ECCost = 1				
			size = 2048
			value = 40						
			duration = 3600  
			SetupMass = .1
			SetupCost = 4000
			UnlockTech = experimentalScience
			requirements = 
			CrewRequirement = 
			ResourceRates = 			
		}
	}
}

//Early Comm Tests
@PART[bluedog_TTS1|bluedog_Transit2A|bluedog_IDCSP_Probe|bluedog_Courier_Core|bluedog_Relay_Core|bluedog_Telstar_Core]:NEEDS[Bluedog_DB,FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = earlyCommTests
	}
}
@PART[*]:HAS[@MODULE[Experiment]]:NEEDS[FeatureScience,Bluedog_DB]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[earlyCommTests]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/ECCost$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/ResourceRates$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/CrewRequirement$
		%allow_shrouded = False
	}
}
// ============================================================================
// Patching the Experiment Definitions, according to the values from the relevant config in the tweakables folder
// ============================================================================
@EXPERIMENT_DEFINITION:HAS[#id[earlyCommTests]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/earlyCommTests/size$
	@dataScale /= #$baseValue$
	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow
		Situation = InSpaceHigh
		BodyAllowed = HomeBody
	}
}

//TIROS
@PART[bluedog_TIROS]:NEEDS[Bluedog_DB,FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = TIROS
	}
}
@PART[*]:HAS[@MODULE[Experiment]]:NEEDS[FeatureScience,Bluedog_DB]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[TIROS]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/ECCost$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/ResourceRates$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/CrewRequirement$
		%allow_shrouded = False
	}
}
// ============================================================================
// Patching the Experiment Definitions, according to the values from the relevant config in the tweakables folder
// ============================================================================
@EXPERIMENT_DEFINITION:HAS[#id[TIROS]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/TIROS/size$
	@dataScale /= #$baseValue$
	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow@Biomes
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[GOES]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/GOES/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/GOES/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceHigh
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[NWS]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/NWS/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/NWS/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[KARS]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/KARS/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/KARS/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow
		BodyAllowed = Gaseous
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[WAMUU]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/WAMUU/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/WAMUU/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceHigh
		BodyAllowed = Atmospheric
		BodyNotAllowed = HomeBody		
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[ESIDISI]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/ESIDISI/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/ESIDISI/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow
		BodyAllowed = Atmospheric
		BodyNotAllowed = HomeBody
		BodyNotAllowed = Gaseous		
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[BATTLE]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/BATTLE/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/BATTLE/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.1
		Situation = InSpaceLow@Biomes
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[COMBAT]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/COMBAT/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/COMBAT/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.2
		Situation = InSpaceLow@Biomes
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[FIGHT]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/FIGHT/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/FIGHT/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.3
		Situation = InSpaceLow@Biomes
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[WARS]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/WARS/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/WARS/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
	
		SampleMass = 0.1
		VirtualBiome = NorthernHemisphere
		VirtualBiome = SouthernHemisphere	
		Situation = InSpaceHigh@VirtualBiomes
		BodyAllowed = HomeBody		
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[CORONA]]:NEEDS[FeatureScience,Bluedog_DB]:BEFORE[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/CORONA/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/Bluedog_DB/CORONA/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.2
		Situation = InSpaceLow@Biomes
		BodyNotAllowed = HomeBody		
	}
}


@PART[bluedog_Camera_InstrumentTorus|bluedog_Nimbus_CameraTorus|bluedog_Nimbus_InstrumentTorus|bluedog_Nimbus_Instrument_ERB|bluedog_Nimbus_Instrument_TOMS|bluedog_Nimbus_Instrument_SAMS]:NEEDS[FeatureScience,Bluedog_DB]:FIRST
{
	MODULE
	{
		name = Configure
		title = Weather Experiments
	}
}

@PART[bluedog_Keyhole_Camera*|bluedog_Hexagon_Camera|bluedog_MOL_Camera|bluedog_Strawman_Thresher]:NEEDS[FeatureScience,Bluedog_DB]:FIRST
{
	MODULE
	{
		name = Configure
		title = Keyhole Experiments
	}
}

@PART[bluedog_Camera_InstrumentTorus|bluedog_Nimbus_CameraTorus|bluedog_Nimbus_InstrumentTorus|bluedog_Nimbus_Instrument_ERB|bluedog_Nimbus_Instrument_TOMS|bluedog_Nimbus_Instrument_SAMS]:HAS[@MODULE[Configure]:HAS[#title[Weather?Experiments]]]:NEEDS[FeatureScience,Bluedog_DB]
{
//adding the experiment modules. The other parameters get added/overwritten later, thus it's pointless to add them here.	
	MODULE
	{
		name = Experiment
		experiment_id = TIROS
	}
	MODULE
	{
		name = Experiment
		experiment_id = NWS
	}
	MODULE
	{
		name = Experiment
		experiment_id = GOES
	}	
	MODULE
	{
		name = Experiment
		experiment_id = WAMUU
	}
	MODULE
	{
		name = Experiment
		experiment_id = ESIDISI
	}
	MODULE
	{
		name = Experiment
		experiment_id = KARS
	}
	
	@MODULE[Configure]:HAS[#title[Weather?Experiments]]
	{
		SETUP
		{
			name = None
			desc = Empty slot for mass and cost savings, should you not require any experiments installed.
		}
		SETUP
		{
			name = TIROS
			desc = Terrestial Imaging and Radar Observation Snapshots: Installs a simple weather imaging camera, along with the systems required to relay images back home.  
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = TIROS
			}
		}
		SETUP
		{
			name = NWS
			desc = Near-orbiting Weather Survey: Installs multiple spectrometers and highly-focused cameras to capture all kinds of useful data about our homeworld, from hurricane wind speed plots to foilage density maps.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = NWS
			}
		}
		SETUP
		{
			name = GOES
			desc = Global Orbital Enviromental Sensor: Installs a powerful pallet of cameras and sensor arrays which allows for long-term observation of our homeworld's weather systems.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = GOES
			}
		}		
		SETUP
		{
			name = WAMUU
			desc = Weather Activity Monitoring Using aUtomation: Installs a slightly less power-hungry version of the GOES pallet which allows for similar observation on alien worlds. 
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = WAMUU
			}
		}
		SETUP
		{
			name = ESIDISI
			desc = Enviromental Sensing Instruments Dedicated to Intensive Storm Investigation: Installs wide-angle cameras which scope out pockets of extreme weather conditions on alien worlds.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = ESIDISI
			}
		}
		SETUP
		{
			name = KARS
			desc = Katabatic Atmospheric and Radiological Study: Installs a highly advanced rad-hardened camera to investigate the climate and atmospheric quirks of gas giants from up close - so long as the rest of the craft doesn't get fried by radiation first!
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = KARS
			}
		}
	}
}

@PART[bluedog_Keyhole_Camera*|bluedog_Hexagon_Camera|bluedog_MOL_Camera|bluedog_Strawman_Thresher]:HAS[@MODULE[Configure]:HAS[#title[Keyhole?Experiments]]]:NEEDS[FeatureScience,Bluedog_DB]
{
//adding the experiment modules. The other parameters get added/overwritten later, thus it's pointless to add them here.	
	MODULE
	{
		name = Experiment
		experiment_id = BATTLE
	}
	MODULE
	{
		name = Experiment
		experiment_id = COMBAT
	}
	MODULE
	{
		name = Experiment
		experiment_id = FIGHT
	}	
	MODULE
	{
		name = Experiment
		experiment_id = WARS
	}
	MODULE
	{
		name = Experiment
		experiment_id = CORONA
	}

	@MODULE[Configure]:HAS[#title[Keyhole?Experiments]]
	{
		SETUP
		{
			name = None
			desc = Empty slot for mass and cost savings, should you not require any experiments installed.
		}
		SETUP
		{
			name = BATTLE
			desc = Basic Analysis of Troops, Territory, and Land Expansion: Installs a high-resoultion camera, capable of capturing basic images of enemy nations, that we could use to supplement current ground-based intel.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = BATTLE
			}
		}
		SETUP
		{
			name = COMBAT
			desc = Close Observation of Military Bases And Troops: Installs multiple focusing lenses onto the BATTLE camera, allowing for us to get higher-resolution images.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = COMBAT
			}
		}
		SETUP
		{
			name = FIGHT
			desc = Focused Investigation of Generally High-importance Targets: Installs an incredibly hyper-focused camera system capable of imaging targets all the way down to resolutions of 1 cm.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = FIGHT
			}
		}		
		SETUP
		{
			name = WARS
			desc = Wide-Angle Reconnisance Survey: Trades the visual cameras for a wide-band X-ray scanner which detect large scale military operations, and also can help identify nuclear detonations
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = WARS
			}
		}
		SETUP
		{
			name = CORONA
			desc = Capturing Observations of extRaterrestrial Objects using Noncivil Architecture: Reuses the old military technology to take qually high-quality images of other planets. 
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = CORONA
			}
		}
	}
}

// ============================================================================
// The experiments were just added above, but not configured. This section takes care of that
// Patching the SETUPs along the way.
// ============================================================================
@PART[bluedog_Camera_InstrumentTorus|bluedog_Nimbus_CameraTorus|bluedog_Nimbus_InstrumentTorus|bluedog_Nimbus_Instrument_ERB|bluedog_Nimbus_Instrument_TOMS|bluedog_Nimbus_Instrument_SAMS]:HAS[@MODULE[Configure]:HAS[#title[Weather?Experiments]]]:NEEDS[FeatureScience,Bluedog_DB]:AFTER[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Weather?Experiments]]
	{
		%slots = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/BaseSlots$

		@SETUP:HAS[#name[TIROS]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/SetupCost$
		}
		
		@SETUP:HAS[#name[NWS]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/SetupCost$
		}

		@SETUP:HAS[#name[GOES]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/SetupCost$
		}
		
		@SETUP:HAS[#name[WAMUU]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/SetupCost$
		}
		
		@SETUP:HAS[#name[ESIDISI]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/SetupCost$
		}

		@SETUP:HAS[#name[KARS]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/SetupCost$
		}

		
	}

	@MODULE[Experiment]:HAS[#experiment_id[TIROS]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/TIROS/ResourceRates$
		%allow_shrouded = False
	}

	@MODULE[Experiment]:HAS[#experiment_id[NWS]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/NWS/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[GOES]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/GOES/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[WAMUU]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/WAMUU/ResourceRates$
		%allow_shrouded = False
	}
		
	@MODULE[Experiment]:HAS[#experiment_id[ESIDISI]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/ESIDISI/ResourceRates$
		%allow_shrouded = False
	}	
	
	@MODULE[Experiment]:HAS[#experiment_id[KARS]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/WEATHER_EXPERIMENTS/KARS/ResourceRates$
		%allow_shrouded = False
	}
	
}

@PART[bluedog_Keyhole_Camera*|bluedog_Hexagon_Camera|bluedog_MOL_Camera|bluedog_Strawman_Thresher]:HAS[@MODULE[Configure]:HAS[#title[Keyhole?Experiments]]]:NEEDS[FeatureScience,Bluedog_DB]:AFTER[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Keyhole?Experiments]]
	{
		%slots = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BaseSlots$

		@SETUP:HAS[#name[BATTLE]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/SetupCost$
		}
		
		@SETUP:HAS[#name[COMBAT]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/SetupCost$
		}

		@SETUP:HAS[#name[FIGHT]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/SetupCost$
		}
		
		@SETUP:HAS[#name[WARS]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/SetupCost$
		}
		
		@SETUP:HAS[#name[CORONA]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/SetupCost$
		}
	
	}

	@MODULE[Experiment]:HAS[#experiment_id[BATTLE]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/BATTLE/ResourceRates$
		%sample_collecting = True		
		%allow_shrouded = False
	}

	@MODULE[Experiment]:HAS[#experiment_id[COMBAT]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/COMBAT/ResourceRates$
		%sample_collecting = True		
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[FIGHT]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/FIGHT/ResourceRates$
		%sample_collecting = True		
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[WARS]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/WARS/ResourceRates$
		%sample_collecting = True		
		%allow_shrouded = False
	}
		
	@MODULE[Experiment]:HAS[#experiment_id[CORONA]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/KEYHOLE_EXPERIMENTS/CORONA/ResourceRates$
		%sample_collecting = True		
		%allow_shrouded = False
	}
}


